<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Xem Chung (Socket.IO)</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .btn { padding: 10px 20px; cursor: pointer; }
        #logs { background: #f4f4f4; height: 200px; overflow-y: scroll; padding: 10px; border: 1px solid #999; }
        .sv-msg { color: blue; font-weight: bold; }
        .my-msg { color: green; }
    </style>
</head>
<body>

    <h2>üõ† TEST T√çNH NƒÇNG XEM CHUNG</h2>

    <div class="box">
        <h3>1. V√†o ph√≤ng</h3>
        <input type="text" id="roomId" placeholder="Nh·∫≠p m√£ ph√≤ng (VD: phim1)" value="phim_avatar">
        <button onclick="joinRoom()" class="btn">V√†o ph√≤ng n√†y</button>
        <p>Tr·∫°ng th√°i: <span id="status" style="color:red">Ch∆∞a k·∫øt n·ªëi</span></p>
    </div>

    <div class="box">
        <h3>2. Gi·∫£ l·∫≠p Video Player</h3>
        <p>B·∫•m n√∫t b√™n d∆∞·ªõi xem Tab kia c√≥ nh·∫≠n ƒë∆∞·ª£c kh√¥ng:</p>
        <button onclick="sendAction('play')" class="btn">‚ñ∂ PLAY</button>
        <button onclick="sendAction('pause')" class="btn">‚è∏ PAUSE</button>
        <button onclick="sendAction('seek')" class="btn">‚è© TUA (ƒë·∫øn 50s)</button>
    </div>

    <div class="box">
        <h3>3. Nh·∫≠t k√Ω t√≠n hi·ªáu</h3>
        <div id="logs"></div>
    </div>

    <script>
        // 1. K·∫æT N·ªêI SERVER (L∆∞u √Ω ƒë√∫ng PORT 8888 nh∆∞ code backend c·ªßa b·∫°n)
        const socket = io("http://localhost:8080");

        let currentRoom = "";

        // Khi k·∫øt n·ªëi th√†nh c√¥ng
        socket.on("connect", () => {
            document.getElementById("status").innerText = "ƒê√£ k·∫øt n·ªëi ID: " + socket.id;
            document.getElementById("status").style.color = "green";
            log("‚úÖ ƒê√£ k·∫øt n·ªëi t·ªõi Server!");
        });

        // 2. H√ÄM G·ª¨I L·ªÜNH (Client -> Server)
        function joinRoom() {
            const room = document.getElementById("roomId").value;
            currentRoom = room;
            // G·ª≠i s·ª± ki·ªán 'join_watch_party' kh·ªõp v·ªõi backend
            socket.emit("join_watch_party", room);
            log(`üì§ B·∫°n ƒë√£ v√†o ph√≤ng: ${room}`, "my-msg");
        }

        function sendAction(action) {
            if (!currentRoom) return alert("V√†o ph√≤ng tr∆∞·ªõc ƒë√£!");
            
            const data = {
                roomId: currentRoom,
                action: action,
                time: 50 // Gi·∫£ ƒë·ªãnh ƒëang ·ªü gi√¢y th·ª© 50
            };

            // G·ª≠i s·ª± ki·ªán 'send_action' kh·ªõp v·ªõi backend
            socket.emit("send_action", data);
            log(`üì§ G·ª≠i l·ªánh: ${action}`, "my-msg");
        }

        // 3. L·∫ÆNG NGHE L·ªÜNH (Server -> Client)
        // ƒê√¢y l√† t√≠n hi·ªáu nh·∫≠n ƒë∆∞·ª£c khi NG∆Ø·ªúI KH√ÅC b·∫•m
        socket.on("receive_action", (data) => {
            log(`üì© NH·∫¨N T·ª™ B·∫†N B√à: L·ªánh [${data.action}] - Time: ${data.time}`, "sv-msg");
            alert(`Video ƒëang t·ª± ƒë·ªông: ${data.action}`);
        });

        // H√†m h·ªó tr·ª£ ghi log ra m√†n h√¨nh
        function log(msg, className = "") {
            const logs = document.getElementById("logs");
            logs.innerHTML += `<div class="${className}">${msg}</div>`;
            logs.scrollTop = logs.scrollHeight; // T·ª± cu·ªôn xu·ªëng d∆∞·ªõi
        }
    </script>
</body>
</html>